{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)4e63c175-40af-44b1-8dfc-bf1c8c0c029a","ParentGuid":"(Guid)2fbba09b-2b13-413f-adb8-36d728ecbad7","Name":"(string)PRG_MySQL","Properties":{"@Type":"2c41fa04:IDictionary","@Value":{}},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)(* state machine *)\nIF xMySQL_Enable THEN\n\tCASE iState OF\n\t\t0\t:\t// idle\n\t\t\t\tIF xMySQL_Connect THEN\n\t\t\t\t\tiState := 10;\n\t\t\t\tELSIF xMySQL_Disconnect THEN\n\t\t\t\t\tiState := 80;\n\t\t\t\tELSIF xMySQL_LogData THEN\n\t\t\t\t\tiState := 40;\n\t\t\t\tEND_IF\n\t\t\t\tsState := 'MySQL idle - wait for command';\n\t\t\n\t\t10\t:\t// connect to DB, prepare login credentials\n\t\t\t\toMySQL_Login.sHost:= sMySQL_Host;\n\t\t\t\toMySQL_Login.uiPort:= uiMySQL_Port;\n\t\t\t\toMySQL_Login.sUsername:= sMySQL_User;\n\t\t\t\toMySQL_Login.sPassword:= sMySQL_Password;\n\t\t\t\toMySQL_Login.sDatabase:= sMySQL_Database;\n\t\t\t\txMySQL_TrigConnect := TRUE;\n\t\t\t\tiState := 11;\n\t\t\t\tsState := 'MySQL connect - Prepare credentials';\n\t\t\n\t\t11\t:\t// login\n\t\t\t\tIF NOT xMySQL_TrigConnect THEN\n\t\t\t\t\tIF xMySQL_Login_Err THEN\n\t\t\t\t\t\tiState := 99;\n\t\t\t\t\t\tsState := 'MySQL connect - Error';\n\t\t\t\t\tELSE\n\t\t\t\t\t\txMySQL_Connect := FALSE;\n\t\t\t\t\t\tiState := 0;\n\t\t\t\t\t\tsState := 'MySQL connect - Connected';\n\t\t\t\t\tEND_IF\n\t\t\t\tEND_IF\n\t\t\n\t\t40\t:\t// log data, prepare statement\n\t\t\t\taMySQL_Statement[0] := 'INSERT INTO myTable (nom, prenom) VALUES ($'CODESYS$', $'Application$');';\n\t\t\t\txMySQL_TrigExecute := TRUE;\n\t\t\t\tiState := 41;\n\t\t\t\tsState := 'MySQL log data - Prepare statement';\n\t\t\t\t\n\t\t41\t:\t//\n\t\t\t\tIF NOT xMySQL_TrigExecute THEN\n\t\t\t\t\tIF xMySQL_Execute_Err THEN\n\t\t\t\t\t\tiState := 99;\n\t\t\t\t\t\tsState := 'MySQL log data - send error';\n\t\t\t\t\tELSE\n\t\t\t\t\t\txMySQL_LogData := FALSE;\n\t\t\t\t\t\tiState := 0;\n\t\t\t\t\t\tsState := 'MySQL log data - send done';\n\t\t\t\t\tEND_IF\n\t\t\t\tEND_IF\n\t\t\t\t\n\t\t80\t:\t// disconnect from DB\n\t\t\t\txMySQL_TrigDisconnect := TRUE;\n\t\t\t\tiState := 81;\n\t\t\t\tsState := 'MySQL disconnect - Prepare disconect command';\n\t\t\t\t\n\t\t81\t:\t// logout\n\t\t\t\tIF NOT xMySQL_TrigDisconnect THEN\n\t\t\t\t\tIF xMySQL_Logout_Err THEN\n\t\t\t\t\t\tiState := 99;\n\t\t\t\t\t\tsState := 'MySQL disconnect - Error';\n\t\t\t\t\tELSE\n\t\t\t\t\t\txMySQL_Disconnect := FALSE;\n\t\t\t\t\t\tiState := 0;\n\t\t\t\t\t\tsState := 'MySQL disconnect - Disconnected';\n\t\t\t\t\tEND_IF\n\t\t\t\tEND_IF\n\t\t\t\t\n\t\t99\t: \t// Error handling\n\t\t\n\tELSE\n\t\tiState := 0;\n\tEND_CASE\nELSE\n\tiState := 0;\nEND_IF\n\n(* instances *)\n{region 'call-instances'}\n\t// login\n\toMySQL_Login(\n\t\txTrigger:= xMySQL_TrigConnect, \n\t\txBusy=> xMySQL_Login_Busy, \n\t\txError=> xMySQL_Login_Err, \n\t\toStatus=> , \n\t\tsStatus=> sMySQL_Login_Status, \n\t\txConnected=> xMySQL_Login_Connected);\n\toMySQL_Login_ShowResult(\n\t\tIResult:= oMySQL_Login.oStatus, \n\t\txIsError=> xMySQL_Login_ErrIsError, \n\t\tuiID=> uiMySQL_Login_ErrID, \n\t\tsDescription=> sMySQL_Login_ErrDesc, \n\t\tsProducer=> sMySQL_Login_ErrProducer, \n\t\tsInstance=> sMySQL_Login_ErrInstance, \n\t\teSeverity=> eMySQL_Login_ErrSeveryty);\n\t\t\n\t//logout\n\toMySQL_Logout(\n\t\txTrigger:= xMySQL_TrigDisconnect, \n\t\txBusy=> xMySQL_Logout_Busy, \n\t\txError=> xMySQL_Logout_Err, \n\t\toStatus=> , \n\t\tsStatus=> sMySQL_Logout_Status);\n\toMySQL_Logout_ShowResult(\n\t\tIResult:= oMySQL_Logout.oStatus, \n\t\txIsError=> xMySQL_Logout_ErrIsError, \n\t\tuiID=> uiMySQL_Logout_ErrID, \n\t\tsDescription=> sMySQL_Logout_ErrDesc, \n\t\tsProducer=> sMySQL_Logout_ErrProducer, \n\t\tsInstance=> sMySQL_Logout_ErrInstance, \n\t\teSeverity=> eMySQL_Logout_ErrSeveryty);\n\t\n\t//execute statement\n\toMySQL_Execute(\n\t\taSqlCommand:= aMySQL_Statement, \n\t\txTrigger:= xMySQL_TrigExecute, \n\t\txBusy=> xMySQL_Execute_Busy, \n\t\txError=> xMySQL_Execute_Err, \n\t\toStatus=> , \n\t\tsStatus=> sMySQL_Execute_Status);\n\toMySQL_Execute_ShowResult(\n\t\tIResult:= oMySQL_Execute.oStatus, \n\t\txIsError=> xMySQL_Execute_ErrIsError, \n\t\tuiID=> uiMySQL_Execute_ErrID, \n\t\tsDescription=> sMySQL_Execute_ErrDesc, \n\t\tsProducer=> sMySQL_Execute_ErrProducer, \n\t\tsInstance=> sMySQL_Execute_ErrInstance, \n\t\teSeverity=> eMySQL_Execute_ErrSeveryty);\n\t\t\n\t// send cyclicly\n\toTONsend(IN:= NOT oTONsend.Q AND xMySQL_Login_Connected, PT:= tSendCycle, Q=> , ET=> );\n\tIF oTONsend.Q THEN\n\t\txMySQL_TrigExecute := TRUE;\n\tEND_IF\n{endregion}\n\n\t","LineInfoPersistence":"(string)4e63c175-40af-44b1-8dfc-bf1c8c0c029a_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)PROGRAM PRG_MySQL\n(* Install a docker container within mysql DB\n   ******************************************\nConfigure the Wago 2GB SD card as EXT4, with label “sdcard”\nenable docker\nls /media/sdcard/ -l\nmkdir -m 777 /media/sdcard/mysql\ndocker info\ndocker network create --driver=bridge --subnet=172.28.0.0/16 --ip-range=172.28.0.0/20 mysqlnet\ndocker run -d --restart always --platform=linux/arm/v7 --network mysqlnet --ip 172.28.0.10 --name mysql -p 3306:3306 -v /etc/localtime:/etc/localtime -v /media/sdcard/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=password1 -e MYSQL_PASSWORD=password1 -e MYSQL_USER=user1 -e MYSQL_DATABASE=database1 biarms/mysql:5\ndocker ps\n\ndocker exec -it mysql sh\nmysql -u root -p\n\nshow databases;\nuse database1;\nshow tables;\nCREATE TABLE  myTable ( id INT AUTO_INCREMENT PRIMARY KEY, nom VARCHAR(100), prenom VARCHAR(100), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);\nshow tables;\nselect * from myTable;\nINSERT INTO myTable (nom, prenom) VALUES ('Rey', 'Stephane');\nselect * from myTable;\ndrop myTable;\n*)\nVAR\n\txMySQL_Enable\t\t\t\t\t: BOOL := TRUE;\n\txMySQL_Connect\t\t\t\t\t: BOOL;\n\txMySQL_Disconnect\t\t\t\t: BOOL;\n\txMySQL_LogData\t\t\t\t\t: BOOL;\n\tsName\t\t\t\t\t\t\t: STRING := 'CODESYS';\n\tsSurname\t\t\t\t\t\t: STRING := 'Application';\n\tiState\t\t\t\t\t\t\t: INT;\n\tsState\t\t\t\t\t\t\t: STRING;\n\t\n\tsMySQL_Host\t\t\t\t\t\t: STRING := '127.0.0.1';\n\tuiMySQL_Port\t\t\t\t\t: UINT := 3306;\n\tsMySQL_User\t\t\t\t\t\t: STRING := 'root';\n\tsMySQL_Password\t\t\t\t\t: STRING := 'password1';\n\tsMySQL_Database\t\t\t\t\t: STRING := 'database1';\n\t\n\t\n\t(* instances *)\n\t// login\n\toMySQL_Login\t\t\t\t\t: WagoAppSQL_MySQL.FbMySql_Login;\n\txMySQL_TrigConnect\t\t\t\t: BOOL;\n\txMySQL_Login_Busy\t\t\t\t: BOOL;\n\txMySQL_Login_Err\t\t\t\t: BOOL;\n\tsMySQL_Login_Status\t\t\t\t: STRING;\n\txMySQL_Login_Connected\t\t\t: BOOL;\n\toMySQL_Login_ShowResult\t\t\t: WagoSysErrorBase.FbShowResult;\n\txMySQL_Login_ErrIsError\t\t\t: BOOL;\n\tuiMySQL_Login_ErrID\t\t\t\t: UINT;\n\tsMySQL_Login_ErrDesc\t\t\t: STRING;\n\tsMySQL_Login_ErrProducer\t\t: STRING;\n\tsMySQL_Login_ErrInstance\t\t: STRING;\n\teMySQL_Login_ErrSeveryty\t\t: WagoTypes.eSeverity;\n\t\n\t// logout\n\toMySQL_Logout\t\t\t\t\t: WagoAppSQL_MySQL.FbMySql_Logout;\n\txMySQL_TrigDisconnect\t\t\t: BOOL;\n\txMySQL_Logout_Busy\t\t\t\t: BOOL;\n\txMySQL_Logout_Err\t\t\t\t: BOOL;\n\tsMySQL_Logout_Status\t\t\t: STRING;\n\toMySQL_Logout_ShowResult\t\t: WagoSysErrorBase.FbShowResult;\n\txMySQL_Logout_ErrIsError\t\t: BOOL;\n\tuiMySQL_Logout_ErrID\t\t\t: UINT;\n\tsMySQL_Logout_ErrDesc\t\t\t: STRING;\n\tsMySQL_Logout_ErrProducer\t\t: STRING;\n\tsMySQL_Logout_ErrInstance\t\t: STRING;\n\teMySQL_Logout_ErrSeveryty\t\t: WagoTypes.eSeverity;\n\t\n\t// execute statement\n\toMySQL_Execute\t\t\t\t\t: WagoAppSQL_MySQL.FbMySql_Execute;\n\txMySQL_TrigExecute\t\t\t\t: BOOL;\n\taMySQL_Statement\t\t\t\t: ARRAY [0..MYSQL_SQL_UPPER_BOUND] OF STRING(MYSQL_SQL_LENGTH);\n\txMySQL_Execute_Busy\t\t\t\t: BOOL;\n\txMySQL_Execute_Err\t\t\t\t: BOOL;\n\tsMySQL_Execute_Status\t\t\t: STRING;\n\toMySQL_Execute_ShowResult\t\t: WagoSysErrorBase.FbShowResult;\n\txMySQL_Execute_ErrIsError\t\t: BOOL;\n\tuiMySQL_Execute_ErrID\t\t\t: UINT;\n\tsMySQL_Execute_ErrDesc\t\t\t: STRING;\n\tsMySQL_Execute_ErrProducer\t\t: STRING;\n\tsMySQL_Execute_ErrInstance\t\t: STRING;\n\teMySQL_Execute_ErrSeveryty\t\t: WagoTypes.eSeverity;\n\t\n\t// send cyclicly\n\toTONsend\t\t\t\t\t\t: ton;\n\ttSendCycle\t\t\t\t\t\t: TIME := T#1800S;\n\t\n\t\nEND_VAR\n","LineInfoPersistence":"(string)4e63c175-40af-44b1-8dfc-bf1c8c0c029a_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)555","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}